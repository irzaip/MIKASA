<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-light">

<div class="container mt-4">
    <h2 class="text-center">Task Manager Dashboard</h2>

    <div class="card p-4">
        <h5>Add New Entry</h5>
        <input type="text" id="project_name" class="form-control mb-2" placeholder="Project Name">
        <select id="task_type" class="form-control mb-2">
            {% for task in task_types %}
            <option value="{{ task }}">{{ task }}</option>
            {% endfor %}
        </select>
        <input type="text" id="prompt" class="form-control mb-2" placeholder="Prompt">
        <input type="text" id="parameters" class="form-control mb-2" placeholder="Parameters">
        <button class="btn btn-primary w-100" onclick="addEntry()">Add Entry</button>
    </div>

    <h5 class="mt-4">Saved Entries</h5>
    <table class="table table-bordered mt-3">
        <thead>
            <tr>
                <th>ID</th>
                <th>Project</th>
                <th>Type</th>
                <th>Prompt</th>
                <th>Parameters</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="entry-list"></tbody>
    </table>

    <button class="btn btn-success w-100 mt-3" onclick="runTasks()">Run All Tasks</button>
</div>

<script>
function fetchEntries() {
    $.get("/get_entries", function(data) {
        let rows = "";
        for (let id in data) {
            rows += `<tr>
                <td>${id}</td>
                <td>${data[id].project_name}</td>
                <td>${data[id].task_type}</td>
                <td>${data[id].prompt}</td>
                <td>${data[id].parameters}</td>
                <td>${data[id].status}</td>
                <td>
                    <button class="btn btn-warning btn-sm" onclick="editEntry(${id})">Edit</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteEntry(${id})">Delete</button>
                </td>
            </tr>`;
        }
        $("#entry-list").html(rows);
    });
}

function addEntry() {
    let data = {
        project_name: $("#project_name").val(),
        task_type: $("#task_type").val(),
        prompt: $("#prompt").val(),
        parameters: $("#parameters").val()
    };
    $.post("/add_entry", JSON.stringify(data), fetchEntries);
}

function runTasks() {
    $.post("/run_tasks", function() {
        alert("All tasks started!");
        fetchEntries();
    });
}

$(document).ready(fetchEntries);
</script>

</body>
</html>
